@using CogLog.App.Constants
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model CogLog.UI.Models.Block.BlockVm

<div class="card">
    <div class="card-header">
        <div class="card-header-top">
            <div class="title-container">
                @if (User.IsInRole(AuthConstants.Roles.Administrator))
                {
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="card-title">@Model.Title</a>
                }
                else
                {
                    <div class="card-title">@Model.Title</div>
                }
            </div>
            @if (User.IsInRole(AuthConstants.Roles.Administrator) && !string.IsNullOrEmpty(@Model.Url))
            {
                <a href="@Model.Url" class="external-link" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                </a>
            }
        </div>
        <div class="card-header-bottom">
            <div class="card-date">@DateOnly.FromDateTime(@Model.LearnedAt).ToString("M/d/yy")</div>
    @if (!string.IsNullOrEmpty(@Model.Subject?.Name))
            {
                <div class="card-subject">#@Model.Subject.Name</div>
            }
        </div>
    </div>

    <div class="card-content">
        @Model.Content
    </div>


    <div class="badge-container" style="display: @(Model.Topics.Count > 0 || Model.Tags.Count > 0 ? "block" : "none");">

        @if (Model.Topics.Count > 0)
        {
            @foreach (var item in Model.Topics)
            {
                @if (User.IsInRole(AuthConstants.Roles.Administrator))
                {
                    <a asp-controller="Topics" asp-action="Details" asp-route-id="@item.Id" class="badge">@item.Name</a>

                }
                else
                {
                    <span class="badge">@item.Name</span>
                }
            }
        }

        @if (Model.Tags.Count > 0)
        {
            @foreach (var item in Model.Tags)
            {
                @if (User.IsInRole(AuthConstants.Roles.Administrator))
                {
                    <a asp-controller="Tags" asp-action="Details" asp-route-id="@item.Id" class="badge">@item.Name</a>

                }
                else
                {
                    <span class="badge">@item.Name</span>
                }
            }
        }
    </div>
    
    


</div>